local chatRevealEnabled = false
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local SayMessageRequest = ReplicatedStorage:WaitForChild("DefaultChatSystemChatEvents"):WaitForChild("SayMessageRequest")

local function onPlayerChatted(player, message)
    local playerName = player.Name
    
    if message == "/commandreveal ON" then
        chatRevealEnabled = true
        SayMessageRequest:FireServer("[System] Chat reveal enabled.", "All")
    elseif message == "/commandreveal OFF" then
        chatRevealEnabled = false
        SayMessageRequest:FireServer("[System] Chat reveal disabled.", "All")
    elseif chatRevealEnabled then
        if string.sub(message, 1, 1) == ";" then 
            SayMessageRequest:FireServer("[" .. playerName .. "] " .. message, "All")
        end
    end
end

local function onPlayerAdded(player)
    player.Chatted:Connect(function(message)
        onPlayerChatted(player, message)
    end)
end

for _, player in ipairs(Players:GetPlayers()) do
    onPlayerAdded(player)
end

Players.PlayerAdded:Connect(onPlayerAdded)
